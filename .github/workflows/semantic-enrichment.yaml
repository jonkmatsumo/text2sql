name: Semantic Enrichment Pipeline

on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: "Run in dry-run mode (no DB commit/LLM cost)"
        required: true
        default: true
        type: boolean

jobs:
  enrich:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          uv sync --no-dev 2>/dev/null || true

      - name: Run Enrichment Pipeline
        env:
          PYTHONPATH: src
          ENABLE_LLM_ENRICHMENT: ${{ inputs.dry_run == false && 'true' || 'false' }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          MEMGRAPH_URI: ${{ secrets.MEMGRAPH_URI }}
          MEMGRAPH_USER: ${{ secrets.MEMGRAPH_USER }}
          MEMGRAPH_PASSWORD: ${{ secrets.MEMGRAPH_PASSWORD }}
        run: |
          python -m ingestion.enrichment.main
