-- Seed Golden Dataset context for evaluation
-- Generated from database/seed_queries.json

INSERT INTO public.golden_dataset (
    question,
    ground_truth_sql,
    expected_result,
    expected_row_count,
    category,
    difficulty,
    tenant_id
) VALUES
-- Easy queries
('What is the total revenue?',
 'SELECT SUM(amount) as total_revenue FROM payment;',
 '[{"total_revenue": 67416.51}]'::jsonb,
 1,
 'aggregation',
 'easy',
 1),

('How many active customers do we have?',
 'SELECT COUNT(*) as active_customers FROM customer WHERE activebool = true;',
 '[{"active_customers": 599}]'::jsonb,
 1,
 'filter',
 'easy',
 1),

('How many rentals have been made in total?',
 'SELECT COUNT(*) as total_rentals FROM rental;',
 '[{"total_rentals": 16044}]'::jsonb,
 1,
 'aggregation',
 'easy',
 1),

('How many films do we have in each rating category?',
 'SELECT rating, COUNT(*) as film_count FROM film GROUP BY rating ORDER BY film_count DESC;',
 '[{"rating": "PG-13", "film_count": 223}, {"rating": "NC-17", "film_count": 210}, {"rating": "R", "film_count": 195}, {"rating": "PG", "film_count": 194}, {"rating": "G", "film_count": 178}]'::jsonb,
 5,
 'group_by',
 'easy',
 1),

('What is the average rental duration in days?',
 'SELECT AVG(EXTRACT(EPOCH FROM (return_date - rental_date))/86400)::numeric(5,2) as avg_rental_days FROM rental WHERE return_date IS NOT NULL;',
 '[{"avg_rental_days": 5.03}]'::jsonb,
 1,
 'aggregation',
 'easy',
 1),

('List all film categories',
 'SELECT name FROM category ORDER BY name;',
 '[{"name": "Action"}, {"name": "Animation"}, {"name": "Children"}, {"name": "Classics"}, {"name": "Comedy"}, {"name": "Documentary"}, {"name": "Drama"}, {"name": "Family"}, {"name": "Foreign"}, {"name": "Games"}, {"name": "Horror"}, {"name": "Music"}, {"name": "New"}, {"name": "Sci-Fi"}, {"name": "Sports"}, {"name": "Travel"}]'::jsonb,
 16,
 'select',
 'easy',
 1),

('How many films are in our inventory?',
 'SELECT COUNT(*) as inventory_count FROM inventory;',
 '[{"inventory_count": 4581}]'::jsonb,
 1,
 'aggregation',
 'easy',
 1),

-- Medium queries
('Who are the top 5 customers by total spending?',
 'SELECT c.customer_id, c.first_name, c.last_name, SUM(p.amount) as total_spent FROM customer c JOIN payment p ON c.customer_id = p.customer_id GROUP BY c.customer_id, c.first_name, c.last_name ORDER BY total_spent DESC LIMIT 5;',
 '[{"customer_id": 526, "first_name": "KARL", "last_name": "SEAL", "total_spent": 221.55}, {"customer_id": 148, "first_name": "ELEANOR", "last_name": "HUNT", "total_spent": 216.54}, {"customer_id": 144, "first_name": "CLARA", "last_name": "SHAW", "total_spent": 195.58}, {"customer_id": 137, "first_name": "RHONDA", "last_name": "KENNEDY", "total_spent": 194.61}, {"customer_id": 178, "first_name": "MARION", "last_name": "SNYDER", "total_spent": 194.61}]'::jsonb,
 5,
 'join_aggregation',
 'medium',
 1),

('What is the monthly revenue breakdown?',
 'SELECT DATE_TRUNC(''month'', payment_date) as month, SUM(amount) as revenue FROM payment GROUP BY month ORDER BY month;',
 '[{"month": "2022-01-01T00:00:00+00:00", "revenue": 3094.78}, {"month": "2022-02-01T00:00:00+00:00", "revenue": 10164.97}, {"month": "2022-03-01T00:00:00+00:00", "revenue": 11413.86}, {"month": "2022-04-01T00:00:00+00:00", "revenue": 10759.52}, {"month": "2022-05-01T00:00:00+00:00", "revenue": 11347.28}, {"month": "2022-06-01T00:00:00+00:00", "revenue": 10923.45}, {"month": "2022-07-01T00:00:00+00:00", "revenue": 9712.65}]'::jsonb,
 7,
 'time_series',
 'medium',
 1),

('What are the most rented films?',
 'SELECT f.title, COUNT(r.rental_id) as rental_count FROM film f JOIN inventory i ON f.film_id = i.film_id JOIN rental r ON i.inventory_id = r.inventory_id GROUP BY f.film_id, f.title ORDER BY rental_count DESC LIMIT 10;',
 '[{"title": "BUCKET BROTHERHOOD", "rental_count": 34}, {"title": "ROCKETEER MOTHER", "rental_count": 33}, {"title": "FORWARD TEMPLE", "rental_count": 32}, {"title": "JUGGLER HARDLY", "rental_count": 32}, {"title": "RIDGEMONT SUBMARINE", "rental_count": 32}, {"title": "GRIT CLOCKWORK", "rental_count": 32}, {"title": "SCALAWAG DUCK", "rental_count": 32}, {"title": "ROBBERS JOON", "rental_count": 31}, {"title": "NETWORK PEAK", "rental_count": 31}, {"title": "TIMBERLAND SKY", "rental_count": 31}]'::jsonb,
 10,
 'join_aggregation',
 'medium',
 1),

('How many customers have made more than 30 rentals?',
 'SELECT COUNT(*) as high_activity_customers FROM (SELECT customer_id, COUNT(*) as rental_count FROM rental GROUP BY customer_id HAVING COUNT(*) > 30) as active_customers;',
 '[{"high_activity_customers": 235}]'::jsonb,
 1,
 'subquery',
 'medium',
 1),

('What is the average payment amount per customer?',
 'SELECT AVG(total_spent)::numeric(5,2) as avg_customer_spend FROM (SELECT customer_id, SUM(amount) as total_spent FROM payment GROUP BY customer_id) as customer_totals;',
 '[{"avg_customer_spend": 112.55}]'::jsonb,
 1,
 'subquery',
 'medium',
 1),

('Which actors appear in the most films?',
 'SELECT a.first_name, a.last_name, COUNT(fa.film_id) as film_count FROM actor a JOIN film_actor fa ON a.actor_id = fa.actor_id GROUP BY a.actor_id, a.first_name, a.last_name ORDER BY film_count DESC LIMIT 5;',
 '[{"first_name": "GINA", "last_name": "DEGENERES", "film_count": 42}, {"first_name": "WALTER", "last_name": "TORN", "film_count": 41}, {"first_name": "MARY", "last_name": "KEITEL", "film_count": 40}, {"first_name": "MATTHEW", "last_name": "CARREY", "film_count": 39}, {"first_name": "SANDRA", "last_name": "KILMER", "film_count": 37}]'::jsonb,
 5,
 'join_aggregation',
 'medium',
 1),

('What is the revenue breakdown by day of week?',
 'SELECT TO_CHAR(payment_date, ''Day'') as day_of_week, SUM(amount) as revenue FROM payment GROUP BY TO_CHAR(payment_date, ''Day''), EXTRACT(DOW FROM payment_date) ORDER BY EXTRACT(DOW FROM payment_date);',
 '[{"day_of_week": "Sunday   ", "revenue": 10188.45}, {"day_of_week": "Monday   ", "revenue": 9519.86}, {"day_of_week": "Tuesday  ", "revenue": 9797.21}, {"day_of_week": "Wednesday", "revenue": 9803.14}, {"day_of_week": "Thursday ", "revenue": 9689.93}, {"day_of_week": "Friday   ", "revenue": 9570.93}, {"day_of_week": "Saturday ", "revenue": 8846.99}]'::jsonb,
 7,
 'time_series',
 'medium',
 1),

-- Hard queries
('Which film categories generate the most revenue?',
 'SELECT cat.name as category, SUM(p.amount) as revenue FROM category cat JOIN film_category fc ON cat.category_id = fc.category_id JOIN film f ON fc.film_id = f.film_id JOIN inventory i ON f.film_id = i.film_id JOIN rental r ON i.inventory_id = r.inventory_id JOIN payment p ON r.rental_id = p.rental_id GROUP BY cat.name ORDER BY revenue DESC LIMIT 5;',
 '[{"category": "Foreign", "revenue": 10507.67}, {"category": "Children", "revenue": 10437.05}, {"category": "Animation", "revenue": 10369.55}, {"category": "Documentary", "revenue": 10307.29}, {"category": "Action", "revenue": 10289.60}]'::jsonb,
 5,
 'join_aggregation',
 'hard',
 1),

('What percentage of rentals are returned late?',
 'SELECT (COUNT(*) FILTER (WHERE return_date > rental_date + (f.rental_duration || '' days'')::interval) * 100.0 / COUNT(*))::numeric(5,2) as late_return_pct FROM rental r JOIN inventory i ON r.inventory_id = i.inventory_id JOIN film f ON i.film_id = f.film_id WHERE return_date IS NOT NULL;',
 '[{"late_return_pct": 7.82}]'::jsonb,
 1,
 'complex_filter',
 'hard',
 1),

('Which customers have not made any rentals in the last 3 months of data?',
 'SELECT c.customer_id, c.first_name, c.last_name FROM customer c WHERE c.customer_id NOT IN (SELECT DISTINCT customer_id FROM rental WHERE rental_date >= (SELECT MAX(rental_date) - INTERVAL ''3 months'' FROM rental)) ORDER BY c.customer_id LIMIT 10;',
 '[{"customer_id": 1, "first_name": "MARY", "last_name": "SMITH"}, {"customer_id": 9, "first_name": "MARGARET", "last_name": "MOORE"}, {"customer_id": 10, "first_name": "DOROTHY", "last_name": "TAYLOR"}, {"customer_id": 16, "first_name": "SANDRA", "last_name": "MARTIN"}, {"customer_id": 21, "first_name": "MICHELLE", "last_name": "CLARK"}, {"customer_id": 24, "first_name": "KIMBERLY", "last_name": "LEE"}, {"customer_id": 33, "first_name": "ANNA", "last_name": "HILL"}, {"customer_id": 40, "first_name": "AMANDA", "last_name": "CARTER"}, {"customer_id": 42, "first_name": "CAROLYN", "last_name": "PEREZ"}, {"customer_id": 45, "first_name": "JANET", "last_name": "PHILLIPS"}]'::jsonb,
 10,
 'subquery',
 'hard',
 1),

-- Expert queries
('What is the running total of revenue by month?',
 'SELECT month, monthly_revenue, SUM(monthly_revenue) OVER (ORDER BY month) as running_total FROM (SELECT DATE_TRUNC(''month'', payment_date) as month, SUM(amount) as monthly_revenue FROM payment GROUP BY DATE_TRUNC(''month'', payment_date)) as monthly ORDER BY month;',
 '[{"month": "2022-01-01T00:00:00+00:00", "monthly_revenue": 3094.78, "running_total": 3094.78}, {"month": "2022-02-01T00:00:00+00:00", "monthly_revenue": 10164.97, "running_total": 13259.75}, {"month": "2022-03-01T00:00:00+00:00", "monthly_revenue": 11413.86, "running_total": 24673.61}, {"month": "2022-04-01T00:00:00+00:00", "monthly_revenue": 10759.52, "running_total": 35433.13}, {"month": "2022-05-01T00:00:00+00:00", "monthly_revenue": 11347.28, "running_total": 46780.41}, {"month": "2022-06-01T00:00:00+00:00", "monthly_revenue": 10923.45, "running_total": 57703.86}, {"month": "2022-07-01T00:00:00+00:00", "monthly_revenue": 9712.65, "running_total": 67416.51}]'::jsonb,
 7,
 'window_function',
 'expert',
 1),

('Rank customers by their total spending',
 'SELECT customer_id, first_name, last_name, total_spent, RANK() OVER (ORDER BY total_spent DESC) as spending_rank FROM (SELECT c.customer_id, c.first_name, c.last_name, SUM(p.amount) as total_spent FROM customer c JOIN payment p ON c.customer_id = p.customer_id GROUP BY c.customer_id, c.first_name, c.last_name) as customer_spending ORDER BY spending_rank LIMIT 10;',
 '[{"customer_id": 526, "first_name": "KARL", "last_name": "SEAL", "total_spent": 221.55, "spending_rank": 1}, {"customer_id": 148, "first_name": "ELEANOR", "last_name": "HUNT", "total_spent": 216.54, "spending_rank": 2}, {"customer_id": 144, "first_name": "CLARA", "last_name": "SHAW", "total_spent": 195.58, "spending_rank": 3}, {"customer_id": 137, "first_name": "RHONDA", "last_name": "KENNEDY", "total_spent": 194.61, "spending_rank": 4}, {"customer_id": 178, "first_name": "MARION", "last_name": "SNYDER", "total_spent": 194.61, "spending_rank": 4}]'::jsonb,
 10,
 'window_function',
 'expert',
 1),

('What is the month-over-month revenue growth rate?',
 'WITH monthly_revenue AS (SELECT DATE_TRUNC(''month'', payment_date) as month, SUM(amount) as revenue FROM payment GROUP BY DATE_TRUNC(''month'', payment_date)) SELECT month, revenue, LAG(revenue) OVER (ORDER BY month) as prev_revenue, ((revenue - LAG(revenue) OVER (ORDER BY month)) / LAG(revenue) OVER (ORDER BY month) * 100)::numeric(5,2) as growth_pct FROM monthly_revenue ORDER BY month;',
 '[{"month": "2022-01-01T00:00:00+00:00", "revenue": 3094.78, "prev_revenue": null, "growth_pct": null}, {"month": "2022-02-01T00:00:00+00:00", "revenue": 10164.97, "prev_revenue": 3094.78, "growth_pct": 228.47}, {"month": "2022-03-01T00:00:00+00:00", "revenue": 11413.86, "prev_revenue": 10164.97, "growth_pct": 12.29}, {"month": "2022-04-01T00:00:00+00:00", "revenue": 10759.52, "prev_revenue": 11413.86, "growth_pct": -5.73}, {"month": "2022-05-01T00:00:00+00:00", "revenue": 11347.28, "prev_revenue": 10759.52, "growth_pct": 5.46}, {"month": "2022-06-01T00:00:00+00:00", "revenue": 10923.45, "prev_revenue": 11347.28, "growth_pct": -3.73}, {"month": "2022-07-01T00:00:00+00:00", "revenue": 9712.65, "prev_revenue": 10923.45, "growth_pct": -11.09}]'::jsonb,
 7,
 'window_function',
 'expert',
 1)

ON CONFLICT DO NOTHING;
